var APP={};var CFG={};var fType={};var thisdir=window.location.origin+window.location.pathname;$(document).ready(function(){getEnvVars();setFileTypes();makeTitle();formatTable();createObjects();bindEvents()});function getEnvVars(){$("#VARS span").each(function(){if($(this).attr("class")=="APP"){APP[$(this).attr("title")]=$(this).html()}if($(this).attr("class")=="CFG"){CFG[$(this).attr("title")]=$(this).html()}});$("#VARS").remove()}function setFileTypes(){fType.image=["ico","gif","jpg","jpeg","jpc","jp2","jpx","xbm","wbmp","png","bmp","tif","tiff","psd","svg","webp","avif"];fType.video=["avi","webm","wmv","mp4","m4v","ogm","ogv","mov","mkv","mpg","mpeg","flv","3gp","asf"];fType.audio=["wav","mp3","mp2","ogg","oga","m4a","flac","aac","wma","mka","ac3"];fType.text=["htaccess","passwd","ftpquota","sh","config","php","php4","php5","phps","phtml","m3u","m3u8","pls","cue","bash","vue","eml","msg","csv","bat","cmd","twig","tpl","md","gitignore","less","sass","scss","c","cpp","cs","py","go","zsh","swift","map","lock","dtd","asp","aspx","asx","asmx","ashx","jsp","jspx","cgi","dockerfile","ruby","toml","vhost","scpt","applescript","csx","cshtml","coffee","cfm","rb","graphql","mustache","jinja","http","handlebars","java","es","es6","markdown","wiki","tmp","top","bot","dat","bak","htpasswd","pl"];fType.document=["doc","docx","xls","xlsx","ppt","pptx","ai","psd","dxf","xps","odt","ods"];fType.plain=["txt","pdf","css","ini","inf","conf","log","sql","js","ts","jsx","tsx","mjs","json","htm","html","shtml","xhtml","xml","xsl","svg","yml","yaml"]}function makeTitle(){var b=decodeURIComponent(APP.REQUEST_URI);b=b.replace("?"+APP.QUERY_STRING,"");var e=APP.HTTP_HOST;if(CFG.CustomTitle!=""&&CFG.CustomTitle!=undefined){e=CFG.CustomTitle}if(b==""||b=="/"){$("title").html(e+" - "+APP.ShortName)}else{$("title").html(e+" ["+b+"] - "+APP.ShortName)}var f='<a href="/" class="host">'+e+"</a>";if(b!=""&&b!="/"){var d=1;var a=b.split("/");var c="";for(d=1;d<a.length;d++){c+="/"+encodeURIComponent(a[d]);if(d==a.length-2){a[d]="<strong>"+a[d]+"</strong>"}f+=' / <a href="'+c+'/">'+a[d]+"</a>"}}$("header h1").html(f)}function formatTable(){var e=["icon fhref","filename fhref","modtime","size","description","actions"];var d=[];var c=[];var b="";$("table tr").each(function(g){if(g==0){$(this).children("th").each(function(h){d.push($(this).html())})}if(g>1){var f=[];$(this).children("td").each(function(h){f.push($(this).html())});if(f.length>1){f.push("&nbsp;")}c.push(f)}});d.push("&nbsp;");$("table").html("");$("table").remove();$("main").append("<table><thead><tr></tr></thead><tbody></tbody></table>");for(th in d){$("table thead tr").append('<th class="'+e[th]+'">'+d[th]+"</th>")}for(tb in c){var a="";for(td in c[tb]){a+='<td class="'+e[td]+'">'+c[tb][td]+"</td>"}if(a!=""){$("table tbody").append('<tr class="item'+tb+'">'+a+"</tr>")}}$("table tr th.modtime a").html("Modified");$("table tr .description").hide();$("table tr .actions").hide();$("table tbody tr").each(function(f){$(this).children("td.icon").append('<span class="hidden">'+getPrettyName($(this).children("td.filename").children("a").html()+"</span>"));if($(this).children("td.filename").children("a").html()=="Parent Directory"){$(this).children("td.filename").children("a").html("<strong>.&nbsp;&nbsp;.&nbsp;&nbsp;&#10548;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong>");$(this).addClass("levelup")}if($(this).children("td.filename").children("a").html()=="!index"){$(this).hide();b=$(this).children("td.filename").children("a").attr("href")}var g=$(this).children("td.description").html();if(g!=""&&g!="&nbsp;"&&g!=undefined){$(this).children("td.filename").append("<br /><small>"+g+"</small>")}$(this).children("td.fhref").children("a").attr("rel",f)});if(b!=""){parseIndexFile(b)}}function createObjects(){$("body").children("address").remove()}function parseIndexFile(a){$.ajax({type:"GET",url:a,success:function(b){b=b.replace(/	/gi,"");b=b.replace(/\r/gi,"\n");b=b.replace(/\n\n/gi,"\n");var d=b.split("\n");for(l in d){var c=d[l].split(":");if(c.length>1&&c[0]!=""){var g=findItemId(c[0]);if(g>-1){var f=c[1].split(";");for(o in f){var e=f[o].split("=");if(e[0]=="icon"){$("main table tbody tr.item"+g+" td.icon img").attr("src",e[1])}if(e[0]=="name"){$("main table tbody tr.item"+g+" td.icon span").html(e[1])}if(e[0]=="description"){if($("main table tbody tr.item"+g+" td.filename small").html()==undefined){$("main table tbody tr.item"+g+" td.filename").append("<br /><small></small>")}$("main table tbody tr.item"+g+" td.filename small").html(e[1]);$("main table tbody tr.item"+g+" td.description").html(e[1])}}}}}}})}var navStarted=false;function bindEvents(){$(window).resize(function(){var d=$("header").height();d+=$("header").css("padding-top").replace("px","")*1;d+=$("header").css("padding-bottom").replace("px","")*1;$("body").css("padding-top",d+"px");var c=$(window).height();c=c-$("footer").height();c=c-($("main table").css("margin-top").replace("px","")*2);c=c-d;$("aside.fitem").css("height",c+"px");if(!$("aside.fitem").hasClass("hidden")){var b=$("aside.fitem").height()-$("aside.fitem .info").height();$("aside.fitem .preview").css("height",b+"px")}$(window).scroll()});$(window).scroll(function(){var b=$(document).scrollTop();$("aside.fitem").css("margin-top",(b+$("table").css("margin-top").replace("px","")*1)+"px")});$("table tbody tr td.fhref, table tbody tr td.fhref a").click(function(){var c={id:-1,filename:""};var b=$(this);if($(this).hasClass("fhref")){b=$(this).children("a")}c.id=b.attr("rel");c.filename=b.attr("href");if(b.parent("td").parent("tr").hasClass("levelup")){c.filename="../"}setTimeout(function(){if(navStarted!=true&&c.id>-1){if(c.filename!="../"){window.location.hash="#"+c.filename}else{window.location.hash=""}}},500);return false});$("table tbody tr td.fhref, table tbody tr td.fhref a").dblclick(function(){navStarted=true;var b=$(this);if($(this).hasClass("fhref")){b=$(this).children("a")}window.location=b.attr("href")});$(window).bind("hashchange",function(){var c=window.location.hash.replace("#","");if(c==""){closeFileBox()}else{var b=findItemId(c);if(b>-1){openFileBox(getFileItem(b))}}return false});$(window).resize();if(window.location.hash!=""&&window.location.hash!="#"){var a=findItemId(window.location.hash.replace("#",""));if(a>-1){openFileBox(getFileItem(a))}}}function getFileItem(b){var a={id:b,type:"unknown",icon:"",name:"",filename:"",path:"",url:"",modtime:"",size:"-",description:""};$("table tbody tr.item"+b+" td").each(function(){if($(this).hasClass("icon")){a.icon=$(this).children("a").children("img").attr("src");a.name=$(this).children("span").html()}if($(this).hasClass("filename")){if(!$(this).parent("tr").hasClass("levelup")){a.filename=$(this).children("a").html()}else{a.filename="../"}a.path=thisdir+a.filename;a.url=thisdir+"#"+a.filename;if(!$(this).parent("tr").hasClass("levelup")){if(a.filename.at(-1)=="/"){a.type="dir"}else{var c=a.filename.split(".");a.type=findFileType(c[c.length-1])}}else{a.type="up"}}if($(this).hasClass("modtime")){a.modtime=$(this).html()}if($(this).hasClass("size")){a.size=$(this).html()}if($(this).hasClass("description")){a.description=$(this).html()}});return(a)}function findFileType(b){var a="unknown";b=b.toLowerCase();for(key in fType){for(ext in fType[key]){if(b==fType[key][ext]){a=key}}}return(a)}function findItemId(a){var b=-1;$("table tbody a").each(function(){if($(this).parent("td").hasClass("filename")){if($(this).attr("href")==a){b=$(this).attr("rel")}}});return(b)}function getPrettyName(a){var b=a;b=b.replace(/_/gi," ");b=b.replace(/-/gi," ");b=b.replace(/   /gi," - ");return(b)}function openFileBox(c){$("aside.fitem *").off("click");$("aside.fitem").html($("template.fitem").html());if($("aside.fitem").hasClass("hidden")){$("aside.fitem").removeClass("hidden");$("table").addClass("side")}$("aside.fitem img").attr("src",c.icon.replace(".32.png",".64.png"));$("aside.fitem h1").html(c.name);$("aside.fitem p.description").html("");if(c.description!=""&&c.description!="&nbsp;"){$("aside.fitem p.description").html(c.description+"<br />")}$("aside.fitem p.description").append("<em>"+c.path+"</em>");$("aside.fitem .actions").html("");$("aside.fitem .actions").append('<a class="open" href="'+c.path+'" target="_blank">Open / Download</a>');$("aside.fitem .actions").append('<a class="cpurl" href="#">Copy URL</a>');$("aside.fitem .actions").append('<a class="share" href="#">Share</a>');$("aside.fitem .actions").append('<a class="close fr" href="#">Close</a>');$("aside.fitem .actions a").click(function(){if($(this).hasClass("close")){window.location.hash=""}if($(this).hasClass("cpurl")){try{navigator.clipboard.writeText(c.path);alert("Copied to clipboard.")}catch(f){prompt("Clipboard is blocked, copy URL from here:",c.path)}}if($(this).hasClass("share")){window.open("https://www.addtoany.com/share#title="+c.name+"&url="+c.path,"add2any","width=800,height=600,location=no,menubar=no,status=no,titlebar=no,toolbar=no")}if(!$(this).hasClass("open")){return false}});if(c.type=="image"){$("aside.fitem .preview").html('<img src="'+c.path+'" alt="" />')}if(c.type=="audio"){$("aside.fitem .preview").html('<audio controls src="'+c.path+'"></audio>')}if(c.type=="video"){$("aside.fitem .preview").html('<video controls src="'+c.path+'"></video>')}if(c.type=="text"){$.ajax({type:"GET",url:c.path,success:function(e){$("aside.fitem .preview").html("<pre>"+e+"</pre>")}})}if(c.type=="document"){var d="about:blank";if(CFG.DocEngine=="gdocs"){d="https://docs.google.com/viewer?embedded=true&amp;hl=en&amp;url="+c.path}if(CFG.DocEngine=="msoffice"){d="https://view.officeapps.live.com/op/embed.aspx?src="+c.path}$("aside.fitem .preview").remove();$("aside.fitem").append('<iframe class="preview" src="'+d+'"></iframe>')}if(c.type=="plain"){$("aside.fitem .preview").remove();$("aside.fitem").append('<iframe class="preview" src="'+c.path+'"></iframe>')}if(c.type=="unknown"){var b=0;var a="&nbsp;<br />";for(b=0;b<6;b++){if(b==3){a+="<br /><br />"}a+='&nbsp; <img src="http://sys.lunet.studio/exc.html/tools/tool=findimg/no='+b+"/return=image/q="+c.name+'" alt="" class="findimg" /> &nbsp;'}$("aside.fitem .preview").html(a)}$(window).resize()}function closeFileBox(){$("aside.fitem").addClass("hidden");$("table").removeClass("side");$("aside.fitem *").remove()};